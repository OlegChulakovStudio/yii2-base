# Поведение "Опциональные поля"

Поведение позволяет обращаться к `json` полю модели как к отдельным полям.
При этом поля можно заранее определить и тем самым ограничить возможность добавлять
любое количество произвольных полей в базу данных.

Поведение не преобразует свойство поля до момента валидации и сохранения,
храня все десериализованные данные у себя в свойствах. Что позволяет не переживать
за валидацию и предоставляет возможность обращаться к полю как строке.

## Использование

Для добавления поведения к модели, необходимо указать:

```php
public function behaviors()
{
    return [
        [
            'class' => \chulakov\base\behaviors\OptionsBehavior::class,
            'attribute' => 'options',
            'options' => ['property', 'field', ...],
        ]
    ];
}
```

После чего можно прописать дополнительную анатацию в DocBlock:

```php
 * @property string $property
 * @property string $field
 * @property ...
 *
 * @method array properties()
 * @method addProperty(string $option)
```

### Свойство $attribute

Указывает поведению в каком поле находится сериализованный `json` объект.
По умолчанию ссылается на атрибут `$options`.

### Свойство $options

Список разрешенных полей модели для хранения в сериализованном виде.
По умолчанию пустой массив и в этом случае заполняется ключами ранее добавленных
в сериализованный атрибут, тем самым ограничивая возможность добавления новых полей.

### Дополнительные возможности

Для управления дополнительными полями добавлены два метода:

- `properties()` - Выводит список дополнительных разрешенных полей.
- `addProperty()` - Добавляет разрешение на добавление нового поля.

### Скрытые возможности

Поведение при валидации и добавлении/обновлении модели сохраняет в укзанное поле
свежие данные по дополнительным полям, что исключает возможность модификации поля
в ручном варианте. Т.е. поле становится закрытым для изменения не через поведение.

Обойти данное ограничение возможно путем ручного обращения к методам сериализации
или десериализации и тем самым повлияв на его данные самостоятельно.

- `encodeOptions()` - Обновляет поле в моделе владельца.
- `decodeOptions()` - Обновляет данные поведения из поля владельца.

Тем не менее, не стоит злоупотреблять подобными возможностями, это может нарушить
целостности документации модели и скрыть существующие поля от пользователя модели.
